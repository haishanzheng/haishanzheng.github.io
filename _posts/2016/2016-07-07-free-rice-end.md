---
title:  "免费米饭完结篇"
date:   2016-07-07 10:58:03 +0800
---


## 文章目录

{:.no_toc}

* toc
{:toc}


写在最前：洪博士评论：贵部门只有你一个在战斗么？哈，可能这2篇博文给大家造成了误解，或许展示的永远是最显眼的，把消费数据拿来展示只是整个系统的最后一个环节，然而大家看到了漂亮的图片，确实忽略了后端支撑的所有人，比如虚拟化平台，没有虚拟化平台，哪能想快照就快照，想克隆就克隆，快速试错呢。Nginx我们已经有同事使用在OA负载均衡上，这些通过内部分享都有了一些技术积累。而还有大量前端产生这些数据的网关，刷卡机部署，数据出错检查。现在的任何一个项目不像以前了，都需要全端的技术，项目的推出都是团队共同努力的结果。我这个，只是玩玩技术交流下而已，堆砌一些技术术语，如果有人能跟我说，你这个做得不对，可以试试这么做，我还有更好的方法，你要不要听？就赚到了。

没想到，晚上6点推出，到10点，已经有1万多人登录并查看了自己的免费米饭统计信息，访问量有点超出我的预期。截止到我写完博客发布前一秒，有7万人次登录了免费米饭统计信息，有1万人分享了自己的免费米饭信息。10点的时候有用户反应服务器速度有点慢了，紧急加了2台前端Web上去，做DNS负载均衡。后端Mongodb在睡觉，前端Web load不高，连接数有点高。第二天在分享页面加了半天缓存时间，前段加上Nginx拦截，然而热点已经慢慢消退了。

如果有想到这些，最开始我就不应该只用Flask，我应该写SPA，用上Javascript的React或者AngularJS2，静态资源启用7img独立域名，版本化后全部放到Nginx内存缓存起来。使用Nginx或者squid负载均衡，缓存Redis和Web分开，前端动静分离，能cache全部cache，每个页面输出cache-control。后端Log分析用AWStats，或者ELK，由于过了负载均衡，所以前端还必须用Piwik收集访问记录。放cookie跟踪传播模式。我就可以在这篇博客里面放上一些高大上的截图分析，甚至可以跟新闻传播专业的人合作，把从第一个江晓莲同学分享出来以后的传播规律做一张大图给出规律。然而正如飞鱼秀喻舟说的：
***这些都没有！***

坑很多，你想要去填坑，只会发现越来越多的坑，前期留下来的技术债务太多。最大的问题出在密码上，很多毕业生毕业后把密码忘记了，看着别人分享捶胸顿足，写信想要重置密码，可我没法确认**你是你，你妈是你妈啊**。有些人跟圕时光 http://tuan.xmulib.org 混淆起来，在统一身份认证密码处孜孜不倦地输入图书馆的登录密码（图书馆支持自己系统密码登录和统一身份认证登录2种模式），值得表扬的是他的图书馆登录密码和统一身份认证登录密码不同，于是输入错误3次他就被锁定了。可惜我改不了统一身份认证源代码，要不然我可以告诉你，同学，密码你是记住了（密码是用脑袋记得么？请用KeePass或者LastPassowrd或者1Password），但是输入的地方错了，我可能记录了你的图书馆登录密码咯。

所以我们对于忘记密码的同学，只能说：因为涉及到同学们的大量个人信息，密码暂时只能由用户本人携带校园卡等证件到一卡通服务中心重置。如你不便到现场，请等待后续校友密码激活方案，感谢关注我们的工作。

请等待？等等，感觉怎么又留了一个坑啊。。。

然后又发现部分年级在新旧学号规则更替过程中有2个学号，这是怎么回事啊，（有公众号转载的有能力帮忙配个图），你有两个身份证你知道不？你要被抓起来的你知道不？所以你输入的那个学号看不到任何信息，当然我可以做个替换，但是，懒啊，需求请排队吧！

还有，数据有噪声，免费米饭测试前期有部分消费不规范，不说了。有些人统计信息不准确，还得查。

有些转述过来的同学的创意很好，于是我改编了下，（美工帮我做个图，很简单，红皮的，现在就要，美工呢？我们有招到美工么？），兹证明 郑XX 于 xx 年 到 xx 年在厦门大学消费 xx 斤免费米饭，特此证明。本证明仅用于证明该同学的食量，不作为我校对该同学任何形势的担保文件。这个证明可以去嘉庚主楼1楼学生事务大厅和翔安校区我不知道放在哪的本科、研究生、教职工自助打印设备上自助打印。

还有，你多久没有回学校吃饭了？**母校喊你回家吃付费米饭**，现在只加收20%咯，享受教工待遇，可以进新新勤业三楼自助咯。消费完你会立刻拿到一个“回归勇士”饰品，物品等级1，拾取绑定。可能还可以顺便绕道到财务处捐点款，不过捐款不需要到现场，支付宝转账就好了，厦门大学教育发展基金会 http://edf.xmu.edu.cn 。

这个坑可能会越来越大，重置密码的同事，图书馆同事，一卡通同事，统一身份认证厂商都被涉及了，所以先搁置了，继续回到原先的工作计划上，DNS，虚拟主机，备案，网络安全，信息化痛点。

最后，这个事情确实很好玩，感谢所有参与的人，你们的想法我们都会认真听的，只不过什么时候做，咳咳。




